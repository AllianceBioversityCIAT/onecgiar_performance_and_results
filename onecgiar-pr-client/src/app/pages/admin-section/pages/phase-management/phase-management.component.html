<div class="table_container" [ngClass]="{ 'expand_table': show_full_screen }">
  <p-table sortField="id" [sortOrder]="-1" [value]="this.phaseList" dataKey="id" [scrollable]="true" editMode="row" [paginator]="true" [rowsPerPageOptions]="[10, 50, 100]" [rows]="10" scrollHeight="calc(100vh - 303px)" style="min-width: 200px" #dt>
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="id">#<p-sortIcon field="id"></p-sortIcon></th>
        <th pSortableColumn="phase_name">Name <p-sortIcon field="phase_name"></p-sortIcon></th>
        <th pSortableColumn="phase_year">Reporting year <p-sortIcon field="phase_year"></p-sortIcon></th>
        <th pSortableColumn="toc_pahse_id">Toc phase <p-sortIcon field="toc_pahse_id"></p-sortIcon></th>
        <th pSortableColumn="start_date">Start date <p-sortIcon field="start_date"></p-sortIcon></th>
        <th pSortableColumn="end_date">End date <p-sortIcon field="end_date"></p-sortIcon></th>
        <th pSortableColumn="status" style="min-width:150px">Status <p-sortIcon field="status"></p-sortIcon></th>
        <th pSortableColumn="obj_previous_phase.phase_name">Previus phase <p-sortIcon field="obj_previous_phase.phase_name"></p-sortIcon></th>
        <th style="min-width: 180px">Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-phase let-editing="editing" let-ri="rowIndex">
      <tr [pEditableRow]="phase">
        
        <td>{{phase.id}}</td>
        <td>
            <p-cellEditor>
                <ng-template pTemplate="input">
                    <input pInputText type="text" [(ngModel)]="phase.phase_name">
                </ng-template>
                <ng-template pTemplate="output">
                    {{phase.phase_name}}
                </ng-template>
            </p-cellEditor>
        </td>
        <td>{{phase.phase_year}}</td>
        <td>{{phase.toc_pahse_id}}</td>
        <td>{{phase.start_date}}</td>
        <td>{{phase.end_date}}</td>
        <td>
            <p-cellEditor>
                <ng-template pTemplate="input">
                    <app-pr-select class="segment_title_margin"
                        [options]="this.status"
                        optionLabel="name" optionValue="status" placeholder="Select status"
                        [(ngModel)]="phase.status">
                    </app-pr-select>
                </ng-template>
                <ng-template pTemplate="output">
                  <div [ngClass]="{'tag_status':true,'open':phase?.status == true,'closed':phase?.status == false}" >{{phase?.status?'Open':'Closed'}}</div>
                </ng-template>
            </p-cellEditor>
        </td>
        <td>
            <p-cellEditor>
                <ng-template pTemplate="input">
                  <app-pr-select class="segment_title_margin"
                        [options]="this.phaseList"
                        [disableOptions]="onlyPreviousPhase(phase)"
                        optionLabel="phase_name" optionValue="id" placeholder="Select previous phase"
                        [(ngModel)]="phase.previous_phase">
                    </app-pr-select>
                </ng-template>
                <ng-template pTemplate="output">
                    {{phase.obj_previous_phase?.phase_name}}
                </ng-template>
            </p-cellEditor>
        </td>
        <td>
          {{!!phase?.is_new}}
          <div class="flex align-items-center justify-content-center gap-2">
              <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil" (click)="onRowEditInit(phase)" class="p-button-rounded p-button-text"></button>
              <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check" (click)="onRowEditSave(phase)" class="p-button-rounded p-button-text p-button-success mr-2"></button>
              <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow [icon]="!!phase?.is_new?'pi pi-trash':'pi pi-times'" (click)="onRowEditCancel(phase, ri)" class="p-button-rounded p-button-text p-button-danger"></button>
          </div>
      </td>
      </tr>
    </ng-template>
  </p-table>
  <div class="counter">
    <div class="name">Phases:</div>
    {{ (this.phaseList | filterByText : this.textToFind).length }}/{{ this.phaseList?.length }}
  </div>
  <app-add-button name="Add new phase" (clickEvent)="addNewPhase()"></app-add-button>
</div>
